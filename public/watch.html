<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Watch Sports Videos & Highlights - AllSports</title>
  <meta name="description" content="Watch the latest sports highlights, full match replays, and exclusive video content."/>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Additional styles for watch page */
    .featured-video-section {
      margin-bottom: var(--space-4);
    }
    
    .featured-video {
      background: var(--card);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
    }
    
    .video-container {
      position: relative;
      display: flex;
      flex-direction: column;
    }
    
    @media (min-width: 768px) {
      .video-container {
        flex-direction: row;
      }
    }
    
    .video-player {
      position: relative;
      flex: 1;
      min-height: 300px;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .video-thumbnail {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .play-btn {
      position: absolute;
      background: rgba(232, 29, 47, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .play-btn:hover {
      background: var(--accent);
      transform: scale(1.1);
    }
    
    .play-btn.large {
      width: 80px;
      height: 80px;
    }
    
    .play-btn.medium {
      width: 50px;
      height: 50px;
    }
    
    .video-info {
      flex: 1;
      padding: var(--space-4);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .video-tag {
      display: inline-block;
      background: var(--accent);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--space-2);
    }
    
    .video-info h2 {
      font-size: 24px;
      margin: 0 0 var(--space-2) 0;
      color: var(--text-primary);
    }
    
    .video-meta {
      display: flex;
      gap: var(--space-2);
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: var(--space-3);
      flex-wrap: wrap;
    }
    
    .video-info p {
      color: var(--text-secondary);
      line-height: 1.6;
      margin: 0;
    }
    
    .video-categories {
      display: flex;
      gap: var(--space-2);
      margin-bottom: var(--space-4);
      overflow-x: auto;
      padding-bottom: var(--space-2);
      scrollbar-width: none;
    }
    
    .video-categories::-webkit-scrollbar {
      display: none;
    }
    
    .video-category {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: var(--text-primary);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .video-category:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 255, 255, 0.25);
    }
    
    .video-category.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }
    
    .videos-main {
      padding: var(--space-4) 0;
    }
    
    .videos-section {
      margin-bottom: var(--space-4);
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-3);
      padding-bottom: var(--space-2);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .section-title {
      font-size: 28px;
      margin: 0;
      color: var(--text-primary);
      position: relative;
      padding-left: 12px;
    }
    
    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 24px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    .section-actions {
      display: flex;
      gap: var(--space-2);
    }
    
    .live-badge {
      background: var(--accent);
      color: white;
      padding: 6px 12px;
      border-radius: var(--radius);
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    
    .videos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--space-3);
    }
    
    .video-card {
      background: var(--card);
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .video-card:hover {
      transform: translateY(-4px);
      border-color: rgba(255,255,255,0.2);
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
    }
    
    .video-card-thumbnail {
      position: relative;
      width: 100%;
      height: 180px;
      overflow: hidden;
      background: #000;
    }
    
    .video-card-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .video-card:hover .video-card-thumbnail img {
      transform: scale(1.05);
    }
    
    .video-card-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .video-card:hover .video-card-overlay {
      opacity: 1;
    }
    
    .video-card-duration {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .video-card-content {
      padding: var(--space-3);
    }
    
    .video-card-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--space-2) 0;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .video-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .video-card-views {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .video-card-date {
      font-size: 12px;
    }
    
    .live-streams-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: var(--space-3);
    }
    
    .live-stream-card {
      background: var(--card);
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid rgba(232, 29, 47, 0.3);
      position: relative;
      transition: all 0.3s ease;
    }
    
    .live-stream-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--accent);
    }
    
    .live-stream-card:hover {
      transform: translateY(-4px);
      border-color: var(--accent);
      box-shadow: 0 8px 30px rgba(232, 29, 47, 0.2);
    }
    
    .live-stream-thumbnail {
      position: relative;
      width: 100%;
      height: 200px;
      overflow: hidden;
      background: #000;
    }
    
    .live-stream-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .live-stream-card:hover .live-stream-thumbnail img {
      transform: scale(1.05);
    }
    
    .live-indicator {
      position: absolute;
      top: 10px;
      left: 10px;
      background: var(--accent);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .live-indicator::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: white;
      animation: pulse 2s infinite;
    }
    
    .live-stream-content {
      padding: var(--space-3);
    }
    
    .live-stream-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--space-2) 0;
      line-height: 1.4;
    }
    
    .live-stream-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: var(--space-2);
    }
    
    .live-stream-sport {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .live-stream-viewers {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .live-stream-description {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: var(--space-3);
    }
    
    .live-stream-actions {
      display: flex;
      gap: var(--space-2);
    }
    
    .live-stream-actions .btn {
      flex: 1;
      text-align: center;
      justify-content: center;
    }
    
    /* Video Modal Styles - FIXED */
    .modal.large .modal-content {
      max-width: 900px;
      width: 95%;
    }
    
    .modal-content.large {
      max-width: 900px;
      width: 95%;
      max-height: 90vh;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-4);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .modal-title {
      font-size: 24px;
      margin: 0;
      color: var(--text-primary);
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .modal-close:hover {
      background: rgba(255,255,255,0.1);
      color: var(--text-primary);
    }
    
    .modal-body {
      padding: 0;
    }
    
    .video-player-modal {
      width: 100%;
      height: 0;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      position: relative;
    }
    
    .video-player-modal iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }
    
    /* Toast notification styles */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--accent);
      color: white;
      padding: 12px 20px;
      border-radius: var(--radius);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    /* Loading state */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: var(--space-4);
      color: var(--text-secondary);
    }
    
    .loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top: 2px solid var(--accent);
      border-radius: 50%;
      margin-left: var(--space-2);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Empty state */
    .empty-state {
      text-align: center;
      padding: var(--space-4);
      color: var(--text-secondary);
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: var(--space-2);
      opacity: 0.5;
    }
    
    .empty-state-text {
      font-size: 18px;
      margin-bottom: var(--space-2);
    }
    
    /* Advanced Search Styles */
    .search-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 0 auto var(--space-4);
    }
    
    .search-box {
      display: flex;
      align-items: center;
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.1);
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .search-box:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(232, 29, 47, 0.2);
    }
    
    .search-input {
      flex: 1;
      padding: var(--space-3);
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 16px;
      outline: none;
    }
    
    .search-input::placeholder {
      color: var(--text-secondary);
    }
    
    .search-actions {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: 0 var(--space-3);
    }
    
    .search-filters-btn {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15);
      color: var(--text-secondary);
      padding: 8px 12px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    
    .search-filters-btn:hover {
      background: rgba(255,255,255,0.12);
      color: var(--text-primary);
    }
    
    .search-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }
    
    .search-btn:hover {
      background: #d32f2f;
    }
    
    .advanced-filters {
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.1);
      padding: var(--space-3);
      margin-top: var(--space-2);
      display: none;
    }
    
    .advanced-filters.active {
      display: block;
    }
    
    .filter-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-1);
    }
    
    .filter-group label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    .filter-select {
      padding: 10px 12px;
      border-radius: var(--radius);
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: var(--text-primary);
      font-size: 14px;
      font-family: inherit;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .filter-select:hover {
      border-color: rgba(255, 255, 255, 0.25);
    }
    
    .filter-select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .search-results-container {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
      z-index: 100;
      max-height: 400px;
      overflow-y: auto;
      display: none;
    }
    
    .search-results-container.active {
      display: block;
    }
    
    .search-result-item {
      padding: var(--space-3);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    
    .search-result-item:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .search-result-item:last-child {
      border-bottom: none;
    }
    
    .search-result-thumbnail {
      width: 60px;
      height: 40px;
      border-radius: 4px;
      overflow: hidden;
      flex-shrink: 0;
    }
    
    .search-result-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .search-result-content {
      flex: 1;
    }
    
    .search-result-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    
    .search-result-meta {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .search-result-type {
      background: rgba(232, 29, 47, 0.1);
      color: var(--accent);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .search-stats {
      padding: var(--space-3);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .no-results {
      padding: var(--space-4);
      text-align: center;
      color: var(--text-secondary);
    }
    
    @media (max-width: 768px) {
      .videos-grid {
        grid-template-columns: 1fr;
      }
      
      .live-streams-grid {
        grid-template-columns: 1fr;
      }
      
      .video-container {
        flex-direction: column;
      }
      
      .video-info {
        padding: var(--space-3);
      }
      
      .video-info h2 {
        font-size: 20px;
      }
      
      .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-2);
      }
      
      .section-actions {
        width: 100%;
      }
      
      .section-actions .btn {
        flex: 1;
      }
      
      .filter-row {
        grid-template-columns: 1fr;
      }
      
      .search-actions {
        flex-direction: column;
        gap: var(--space-1);
        padding: var(--space-2);
      }
      
      .search-filters-btn, .search-btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
<!-- Top Color Strip -->
<div class="top-strip" aria-hidden="true"></div>

<!-- Header -->
<header class="site-header" role="banner" id="siteHeader">
  <div class="header-inner">
    <a class="brand" href="/" aria-label="AllSports home">
      <div class="logo">
        <img src="https://i.pinimg.com/736x/1a/03/15/1a0315e084288700eaf5451d53aeffad.jpg" alt="AllSports Logo">
      </div>
      <div class="brand-text">
        <h1>AllSports</h1>
        <p>Latest sports news & live updates</p>
      </div>
    </a>

    <!-- Main Navigation -->
    <nav class="main-nav" role="navigation" aria-label="Primary navigation">
      <ul class="nav-list" role="menubar">
        <li role="none">
          <a role="menuitem" href="index.html" class="nav-link">Home</a>
        </li>
        
        <!-- Sports Dropdown -->
        <li role="none" class="has-dropdown" aria-haspopup="true">
          <button class="nav-link nav-button" aria-controls="sportsMenu" aria-haspopup="true" aria-expanded="false">
            Sports <span class="caret">‚ñæ</span>
          </button>
          <div id="sportsMenu" class="dropdown sports-dropdown" role="menu" aria-hidden="true">
            <div class="dropdown-grid" role="group" aria-label="Sports list">
              <a role="menuitem" href="games/football.html" class="dropdown-item">
                <span class="sport-icon">‚öΩ</span> Football
              </a>
              <a role="menuitem" href="games/cricket.html" class="dropdown-item">
                <span class="sport-icon">üèè</span> Cricket
              </a>
              <a role="menuitem" href="games/basketball.html" class="dropdown-item">
                <span class="sport-icon">üèÄ</span> Basketball
              </a>
              <a role="menuitem" href="games/tennis.html" class="dropdown-item">
                <span class="sport-icon">üéæ</span> Tennis
              </a>
              <a role="menuitem" href="games/baseball.html" class="dropdown-item">
                <span class="sport-icon">‚öæ</span> Baseball
              </a>
              <a role="menuitem" href="games/hockey.html" class="dropdown-item">
                <span class="sport-icon">üèí</span> Hockey
              </a>
              <a role="menuitem" href="games/golf.html" class="dropdown-item">
                <span class="sport-icon">‚õ≥</span> Golf
              </a>
              <a role="menuitem" href="games/rugby.html" class="dropdown-item">
                <span class="sport-icon">üèâ</span> Rugby
              </a>
              <a role="menuitem" href="games/formula1.html" class="dropdown-item">
                <span class="sport-icon">üèéÔ∏è</span> Formula 1
              </a>
              <a role="menuitem" href="games/boxing.html" class="dropdown-item">
                <span class="sport-icon">ü•ä</span> Boxing
              </a>
              <a role="menuitem" href="games/mma.html" class="dropdown-item">
                <span class="sport-icon">ü•ã</span> MMA
              </a>
              <a role="menuitem" href="games/olympics.html" class="dropdown-item">
                <span class="sport-icon">üèÖ</span> Olympics
              </a>
            </div>
          </div>
        </li>

        <li role="none">
          <a role="menuitem" href="scores.html" class="nav-link">Scores</a>
        </li>

        <li role="none">
          <a role="menuitem" href="watch.html" class="nav-link nav-active" aria-current="page">Watch</a>
        </li>

        <li role="none">
          <a role="menuitem" href="teams.html" class="nav-link">Teams</a>
        </li>

         <li role="none">
          <a role="menuitem" href="players.html" class="nav-link">Players</a>
        </li>


        <li role="none">
          <a role="menuitem" href="fixtures.html" class="nav-link">Fixtures</a>
        </li>

        <!-- Profile Link -->
        <li role="none">
          <a role="menuitem" href="profile.html" class="nav-link nav-active" aria-current="page">Profile</a>
        </li>
      </ul>
    </nav>
      
      <!-- User menu -->
      <div class="user-menu">
        <button class="btn btn-login" id="loginBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
          <span id="loginText">Login</span>
        </button>
        <div class="user-dropdown" id="userDropdown">
          <a href="#" id="logoutBtn">Sign Out</a>
        </div>
      </div>
    </div>

    <!-- Mobile Hamburger -->
    <button id="mobileToggle" class="hamburger" aria-label="Open menu" aria-expanded="false" aria-controls="mobileMenu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>

  <!-- Mobile Navigation Panel -->
  <div id="mobileMenu" class="mobile-panel" aria-hidden="true" role="dialog" aria-label="Mobile navigation">
    <div class="mobile-panel-header">
      <div class="brand">
        <div class="logo">
          <img src="https://i.pinimg.com/736x/1a/03/15/1a0315e084288700eaf5451d53aeffad.jpg" alt="AllSports Logo">
        </div>
        <div class="brand-text">
          <h2>AllSports</h2>
        </div>
      </div>
      <button class="mobile-close" aria-label="Close menu">‚úï</button>
    </div>
    
    <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
      <ul class="mobile-nav-list">
        <li><a href="index.html" class="mobile-nav-link">Home</a></li>
        
        <li class="mobile-dropdown">
          <button class="mobile-nav-link mobile-nav-button" aria-expanded="false">
            Sports <span class="mobile-caret">‚ñæ</span>
          </button>
          <div class="mobile-dropdown-menu" aria-hidden="true">
            <a href="games/football.html" class="mobile-dropdown-item">‚öΩ Football</a>
            <a href="games/cricket.html" class="mobile-dropdown-item">üèè Cricket</a>
            <a href="games/basketball.html" class="mobile-dropdown-item">üèÄ Basketball</a>
            <a href="games/tennis.html" class="mobile-dropdown-item">üéæ Tennis</a>
            <a href="games/baseball.html" class="mobile-dropdown-item">‚öæ Baseball</a>
            <a href="games/hockey.html" class="mobile-dropdown-item">üèí Hockey</a>
            <a href="games/golf.html" class="mobile-dropdown-item">‚õ≥ Golf</a>
            <a href="games/rugby.html" class="mobile-dropdown-item">üèâ Rugby</a>
            <a href="games/formula1.html" class="mobile-dropdown-item">üèéÔ∏è Formula 1</a>
            <a href="games/boxing.html" class="mobile-dropdown-item">ü•ä Boxing</a>
            <a href="games/mma.html" class="mobile-dropdown-item">ü•ã MMA</a>
            <a href="games/olympics.html" class="mobile-dropdown-item">üèÖ Olympics</a>
          </div>
        </li>
        
        <li><a href="scores.html" class="mobile-nav-link">Scores</a></li>
        <li><a href="watch.html" class="mobile-nav-link mobile-nav-active">Watch</a></li>
        <li><a href="teams.html" class="mobile-nav-link">Teams</a></li>
        <li><a href="fixtures.html" class="mobile-nav-link">Fixtures</a></li>
        
       <!-- Profile Link -->
        <li role="none">
          <a role="menuitem" href="profile.html" class="nav-link nav-active" aria-current="page">Profile</a>
        </li>
      </ul>
    </nav>
      </ul>
    </nav>

    <div class="mobile-actions">
      <div class="search mobile-search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input placeholder="Search videos..." aria-label="Search videos" id="mobileSearchInput">
      </div>
      
      <div class="user-menu">
        <button class="btn btn-login mobile-login" id="mobileLoginBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
          <span id="mobileLoginText">Login</span>
        </button>
        <div class="user-dropdown" id="mobileUserDropdown">
          <a href="#" id="mobileLogoutBtn">Sign Out</a>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Main Content -->
<div class="container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">Watch Sports Videos</h1>
    <p class="page-subtitle">Highlights, full matches, analysis and exclusive content</p>
  </div>

  <!-- Advanced Search -->
  <div class="search-container">
    <div class="search-box">
      <input 
        type="text" 
        class="search-input" 
        id="videoSearchInput" 
        placeholder="Search videos by title, description, sport, or category..."
        aria-label="Search videos"
      >
      <div class="search-actions">
        <button class="search-filters-btn" id="filtersToggle">
          <i class="fas fa-sliders-h"></i>
          Filters
        </button>
        <button class="search-btn" id="searchButton">
          <i class="fas fa-search"></i>
          Search
        </button>
      </div>
    </div>
    
    <div class="advanced-filters" id="advancedFilters">
      <div class="filter-row">
        <div class="filter-group">
          <label for="sportFilter">Sport</label>
          <select id="sportFilter" class="filter-select">
            <option value="all">All Sports</option>
            <option value="football">‚öΩ Football</option>
            <option value="basketball">üèÄ Basketball</option>
            <option value="cricket">üèè Cricket</option>
            <option value="tennis">üéæ Tennis</option>
            <option value="baseball">‚öæ Baseball</option>
            <option value="hockey">üèí Hockey</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="categoryFilter">Category</label>
          <select id="categoryFilter" class="filter-select">
            <option value="all">All Categories</option>
            <option value="highlights">Highlights</option>
            <option value="analysis">Analysis</option>
            <option value="live">Live Streams</option>
            <option value="full-match">Full Matches</option>
            <option value="interviews">Interviews</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="durationFilter">Duration</label>
          <select id="durationFilter" class="filter-select">
            <option value="all">Any Duration</option>
            <option value="short">Short (0-5 min)</option>
            <option value="medium">Medium (5-15 min)</option>
            <option value="long">Long (15+ min)</option>
          </select>
        </div>
      </div>
      
      <div class="filter-row">
        <div class="filter-group">
          <label for="dateFilter">Upload Date</label>
          <select id="dateFilter" class="filter-select">
            <option value="all">Any Time</option>
            <option value="today">Today</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
            <option value="year">This Year</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="sortFilter">Sort By</label>
          <select id="sortFilter" class="filter-select">
            <option value="relevance">Relevance</option>
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="popular">Most Popular</option>
            <option value="duration">Duration</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>&nbsp;</label>
          <button class="btn btn-secondary" id="resetFilters">Reset Filters</button>
        </div>
      </div>
    </div>
    
    <div class="search-results-container" id="searchResultsContainer">
      <!-- Search results will be populated by JavaScript -->
    </div>
  </div>

  <!-- Featured Video Section -->
  <section class="featured-video-section" id="featuredVideoSection">
    <div class="featured-video">
      <div class="video-container">
        <div class="video-player" id="featuredVideoPlayer" data-video-id="featured">
          <img src="https://slapioneer.wordpress.com/wp-content/uploads/2013/11/cristiano-ronaldo-sweden-goal.gif" alt="Portugal vs Sweden - World Cup Qualifiers" class="video-thumbnail">
          <button class="play-btn large" aria-label="Play featured video">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
        </div>
        <div class="video-info">
          <div class="video-tag">‚öΩ Featured</div>
          <h2>Portugal vs Sweden - World Cup Qualifiers</h2>
          <div class="video-meta">
            <span>2.5M views</span>
            <span>‚Ä¢</span>
            <span>15:42</span>
            <span>‚Ä¢</span>
            <span>Published 2 hours ago</span>
          </div>
          <p>Watch the full highlights from the thrilling World Cup qualifier between Portugal and Sweden. Cristiano Ronaldo scored a stunning hat-trick in this exciting match.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Video Categories -->
  <div class="video-categories">
    <button class="video-category active" data-category="all">All Videos</button>
    <button class="video-category" data-category="football">‚öΩ Football</button>
    <button class="video-category" data-category="basketball">üèÄ Basketball</button>
    <button class="video-category" data-category="cricket">üèè Cricket</button>
    <button class="video-category" data-category="tennis">üéæ Tennis</button>
    <button class="video-category" data-category="baseball">‚öæ Baseball</button>
    <button class="video-category" data-category="highlights">Highlights</button>
    <button class="video-category" data-category="analysis">Analysis</button>
  </div>

  <!-- Videos Grid -->
  <main class="videos-main">
    <section class="videos-section">
      <div class="section-header">
        <h2 class="section-title">Latest Videos</h2>
      </div>
      
      <div class="videos-grid" id="videosGrid">
        <!-- Videos will be populated by JavaScript -->
        <div class="loading">Loading videos...</div>
      </div>
    </section>

    <!-- Live Streams Section -->
    <section class="videos-section">
      <div class="section-header">
        <h2 class="section-title">Live Streams</h2>
        <div class="live-badge">LIVE NOW</div>
      </div>
      
      <div class="live-streams-grid" id="liveStreamsGrid">
        <!-- Live streams will be populated by JavaScript -->
        <div class="loading">Loading live streams...</div>
      </div>
    </section>
  </main>
</div>

<!-- Footer -->
<footer role="contentinfo">
  <div class="footer-content">
    <div class="footer-section">
      <h5>AllSports</h5>
      <p>Your premier destination for sports news, live scores, and video highlights.</p>
    </div>
    <div class="footer-section">
      <h5>Sports</h5>
      <a href="games/football.html">Football</a>
      <a href="games/cricket.html">Cricket</a>
      <a href="games/basketball.html">Basketball</a>
      <a href="games/tennis.html">Tennis</a>
    </div>
    <div class="footer-section">
      <h5>Company</h5>
      <a href="#about">About</a>
      <a href="#contact">Contact</a>
      <a href="#privacy">Privacy</a>
      <a href="#terms">Terms</a>
    </div>
  </div>
  <div class="footer-bottom">
    ¬© 2024 AllSports ‚Äî Built with ‚ù§Ô∏è for sports fans worldwide
  </div>
</footer>

<!-- Video Modal -->
<div class="modal" id="videoModal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="modal-backdrop" id="videoModalBackdrop"></div>
  <div class="modal-content large" role="document">
    <div class="modal-header">
      <h3 id="videoModalTitle">Video Player</h3>
      <button class="modal-close" aria-label="Close" id="videoModalClose">‚úï</button>
    </div>
    <div class="modal-body">
      <div id="videoContainer">
        <!-- Video player will be injected by JavaScript -->
      </div>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<script>
// Watch App
class WatchApp {
  constructor() {
    this.state = {
      user: null,
      currentCategory: 'all',
      currentSort: 'recent',
      videos: [],
      liveStreams: [],
      savedVideos: new Set(),
      watchedVideos: new Set(),
      searchQuery: '',
      searchFilters: {
        sport: 'all',
        category: 'all',
        duration: 'all',
        date: 'all',
        sort: 'relevance'
      }
    };
    
    this.init();
  }

  async init() {
    console.log('Watch App Initializing...');
    await this.checkAuthStatus();
    await this.loadUserPreferences();
    this.setupEventListeners();
    this.loadFeaturedVideo();
    this.loadVideos();
    this.loadLiveStreams();
    this.setupSearch();
  }

  async checkAuthStatus() {
    try {
      const response = await fetch('/api/user');
      const data = await response.json();
      
      if (data.success && data.user) {
        this.state.user = data.user;
        this.updateAuthUI();
        console.log('User authenticated:', this.state.user.username);
      } else {
        console.log('User not authenticated');
      }
    } catch (error) {
      console.error('Error checking auth status:', error);
    }
  }

  async loadUserPreferences() {
    try {
      if (!this.state.user) {
        console.log('User not logged in, skipping preferences load');
        return;
      }

      const response = await fetch('/api/user/watch-history');
      const data = await response.json();
      
      if (data.success) {
        const watchedVideoIds = data.watchHistory.map(item => item.videoId);
        this.state.watchedVideos = new Set(watchedVideoIds);
        console.log('Loaded user watch history:', watchedVideoIds.length, 'videos');
      } else {
        console.log('No watch history found or user not logged in');
        this.state.watchedVideos = new Set();
      }
      
      this.state.savedVideos = new Set();
      
    } catch (error) {
      console.error('Error loading user preferences:', error);
      this.state.watchedVideos = new Set();
      this.state.savedVideos = new Set();
    }
  }

  updateAuthUI() {
    const loginText = document.getElementById('loginText');
    const mobileLoginText = document.getElementById('mobileLoginText');
    const userDropdown = document.getElementById('userDropdown');
    const mobileUserDropdown = document.getElementById('mobileUserDropdown');
    
    if (this.state.user) {
      if (loginText) loginText.textContent = this.state.user.username;
      if (mobileLoginText) mobileLoginText.textContent = this.state.user.username;
      
      if (userDropdown) userDropdown.style.display = 'none';
      if (mobileUserDropdown) mobileUserDropdown.style.display = 'none';
    } else {
      if (loginText) loginText.textContent = 'Login';
      if (mobileLoginText) mobileLoginText.textContent = 'Login';
      
      if (userDropdown) userDropdown.style.display = 'none';
      if (mobileUserDropdown) mobileUserDropdown.style.display = 'none';
    }
  }

  async handleLogout() {
    try {
      const response = await fetch('/api/logout', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      });
      
      const data = await response.json();
      
      if (data.success) {
        this.state.user = null;
        this.updateAuthUI();
        this.showToast('Logged out successfully');
        
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1000);
      } else {
        this.showToast('Error logging out');
      }
    } catch (error) {
      console.error('Logout error:', error);
      this.showToast('Error logging out');
    }
  }

  async loadFeaturedVideo() {
    try {
      const response = await fetch('/api/videos/featured');
      const data = await response.json();
      
      if (data.success && data.video) {
        this.renderFeaturedVideo(data.video);
      } else {
        console.error('Error loading featured video:', data.message);
        this.renderFeaturedVideo({
          videoId: 'featured',
          title: 'Portugal vs Sweden - World Cup Qualifiers',
          thumbnail: 'https://slapioneer.wordpress.com/wp-content/uploads/2013/11/cristiano-ronaldo-sweden-goal.gif',
          description: 'Watch the full highlights from the thrilling World Cup qualifier between Portugal and Sweden. Cristiano Ronaldo scored a stunning hat-trick in this exciting match.',
          views: '2.5M',
          duration: '15:42',
          publishedAt: '2 hours ago'
        });
      }
    } catch (error) {
      console.error('Error loading featured video:', error);
      this.renderFeaturedVideo({
        videoId: 'featured',
        title: 'Portugal vs Sweden - World Cup Qualifiers',
        thumbnail: 'https://slapioneer.wordpress.com/wp-content/uploads/2013/11/cristiano-ronaldo-sweden-goal.gif',
        description: 'Watch the full highlights from the thrilling World Cup qualifier between Portugal and Sweden. Cristiano Ronaldo scored a stunning hat-trick in this exciting match.',
        views: '2.5M',
        duration: '15:42',
        publishedAt: '2 hours ago'
      });
    }
  }

  async loadVideos() {
    try {
      const response = await fetch(`/api/videos?type=video&category=${this.state.currentCategory}`);
      const data = await response.json();
      
      if (data.success) {
        this.state.videos = data.videos;
        this.renderVideos();
      } else {
        console.error('Error loading videos:', data.message);
        this.showFallbackData();
      }
    } catch (error) {
      console.error('Error loading videos:', error);
      this.showFallbackData();
    }
  }

  async loadLiveStreams() {
    try {
      const response = await fetch('/api/videos/live');
      const data = await response.json();
      
      if (data.success) {
        this.state.liveStreams = data.liveStreams;
        this.renderLiveStreams();
      } else {
        console.error('Error loading live streams:', data.message);
        this.showFallbackLiveStreams();
      }
    } catch (error) {
      console.error('Error loading live streams:', error);
      this.showFallbackLiveStreams();
    }
  }

  renderFeaturedVideo(video) {
    const featuredVideoSection = document.getElementById('featuredVideoSection');
    if (!featuredVideoSection) return;

    const featuredVideoPlayer = document.getElementById('featuredVideoPlayer');
    const videoInfo = featuredVideoPlayer.closest('.video-container').querySelector('.video-info');
    
    if (featuredVideoPlayer) {
      featuredVideoPlayer.dataset.videoId = video.videoId;
      const thumbnail = featuredVideoPlayer.querySelector('.video-thumbnail');
      if (thumbnail) thumbnail.src = video.thumbnail;
    }
    
    if (videoInfo) {
      const title = videoInfo.querySelector('h2');
      const description = videoInfo.querySelector('p');
      const meta = videoInfo.querySelector('.video-meta');
      
      if (title) title.textContent = video.title;
      if (description) description.textContent = video.description;
      if (meta) {
        meta.innerHTML = `
          <span>${video.views} views</span>
          <span>‚Ä¢</span>
          <span>${video.duration}</span>
          <span>‚Ä¢</span>
          <span>Published ${video.publishedAt}</span>
        `;
      }
    }
  }

  renderVideos() {
    const videosGrid = document.getElementById('videosGrid');
    
    if (!videosGrid) return;
    
    if (this.state.videos.length === 0) {
      this.showFallbackData();
      return;
    }
    
    // Filter videos based on current category and search
    let filteredVideos = this.state.videos;
    
    // Apply category filter - FIXED LOGIC
    if (this.state.currentCategory !== 'all') {
      filteredVideos = this.state.videos.filter(video => {
        // Check if category matches (handling both array and string cases)
        const categoryMatch = Array.isArray(video.category) 
          ? video.category.some(cat => 
              cat.toLowerCase().includes(this.state.currentCategory.toLowerCase()) ||
              this.state.currentCategory.toLowerCase().includes(cat.toLowerCase())
            )
          : (video.category && video.category.toLowerCase().includes(this.state.currentCategory.toLowerCase()));
        
        // Check if sport matches
        const sportMatch = video.sport && 
          video.sport.toLowerCase().includes(this.state.currentCategory.toLowerCase());
        
        // Check if tags match
        const tagMatch = video.tags && 
          video.tags.some(tag => tag.toLowerCase().includes(this.state.currentCategory.toLowerCase()));
        
        return categoryMatch || sportMatch || tagMatch;
      });
    }
    
    // Apply search filter if there's a query
    if (this.state.searchQuery) {
      const query = this.state.searchQuery.toLowerCase();
      filteredVideos = filteredVideos.filter(video => 
        video.title.toLowerCase().includes(query) ||
        (video.description && video.description.toLowerCase().includes(query)) ||
        (video.sport && video.sport.toLowerCase().includes(query)) ||
        (Array.isArray(video.category) 
          ? video.category.some(cat => cat.toLowerCase().includes(query))
          : (video.category && video.category.toLowerCase().includes(query))) ||
        (video.tags && video.tags.some(tag => tag.toLowerCase().includes(query)))
      );
    }
    
    // Sort videos based on current sort
    if (this.state.currentSort === 'popular') {
      filteredVideos.sort((a, b) => {
        const aViews = this.parseViews(a.views);
        const bViews = this.parseViews(b.views);
        return bViews - aViews;
      });
    } else {
      // Default: recent (already in order)
    }
    
    if (filteredVideos.length === 0) {
      videosGrid.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">üìπ</div>
          <div class="empty-state-text">No videos found</div>
          <p>Try selecting a different category or search term</p>
        </div>
      `;
      return;
    }
    
    let videosHTML = '';
    
    filteredVideos.forEach(video => {
      const isSaved = this.state.savedVideos.has(video.videoId);
      const isWatched = this.state.watchedVideos.has(video.videoId);
      
      videosHTML += `
        <div class="video-card" data-video-id="${video.videoId}">
          <div class="video-card-thumbnail">
            <img src="${video.thumbnail}" alt="${video.title}">
            <div class="video-card-overlay">
              <button class="play-btn medium" aria-label="Play video">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 5v14l11-7z"/>
                </svg>
              </button>
            </div>
            <div class="video-card-duration">${video.duration}</div>
          </div>
          <div class="video-card-content">
            <h3 class="video-card-title">${video.title}</h3>
            <div class="video-card-meta">
              <div class="video-card-views">
                <i class="fas fa-eye"></i>
                <span>${video.views}</span>
              </div>
              <div class="video-card-date">${video.publishedAt}</div>
            </div>
          </div>
        </div>
      `;
    });
    
    videosGrid.innerHTML = videosHTML;
    
    // Add event listeners to video cards
    const videoCards = videosGrid.querySelectorAll('.video-card');
    videoCards.forEach(card => {
      card.addEventListener('click', (e) => {
        const videoId = card.dataset.videoId;
        const video = this.state.videos.find(v => v.videoId === videoId);
        if (video) {
          this.playVideo(video);
        }
      });
    });
  }

  renderLiveStreams() {
    const liveStreamsGrid = document.getElementById('liveStreamsGrid');
    
    if (!liveStreamsGrid) return;
    
    if (this.state.liveStreams.length === 0) {
      this.showFallbackLiveStreams();
      return;
    }
    
    // Apply search filter if there's a query
    let filteredStreams = this.state.liveStreams;
    
    if (this.state.searchQuery) {
      const query = this.state.searchQuery.toLowerCase();
      filteredStreams = this.state.liveStreams.filter(stream => 
        stream.title.toLowerCase().includes(query) ||
        (stream.description && stream.description.toLowerCase().includes(query)) ||
        (stream.sport && stream.sport.toLowerCase().includes(query))
      );
    }
    
    // Apply category filter to live streams
    if (this.state.currentCategory !== 'all') {
      filteredStreams = filteredStreams.filter(stream => {
        const sportMatch = stream.sport && 
          stream.sport.toLowerCase().includes(this.state.currentCategory.toLowerCase());
        
        const categoryMatch = stream.category && 
          stream.category.toLowerCase().includes(this.state.currentCategory.toLowerCase());
        
        return sportMatch || categoryMatch;
      });
    }
    
    if (filteredStreams.length === 0) {
      liveStreamsGrid.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">üî¥</div>
          <div class="empty-state-text">No live streams available</div>
          <p>Check back later for live events</p>
        </div>
      `;
      return;
    }
    
    let streamsHTML = '';
    
    filteredStreams.forEach(stream => {
      streamsHTML += `
        <div class="live-stream-card" data-stream-id="${stream.videoId}">
          <div class="live-stream-thumbnail">
            <img src="${stream.thumbnail}" alt="${stream.title}">
            <div class="live-indicator">LIVE</div>
          </div>
          <div class="live-stream-content">
            <h3 class="live-stream-title">${stream.title}</h3>
            <div class="live-stream-meta">
              <div class="live-stream-sport">
                <span class="sport-icon">${this.getSportIcon(stream.sport)}</span>
                <span>${this.formatSportName(stream.sport)}</span>
              </div>
              <div class="live-stream-viewers">
                <i class="fas fa-users"></i>
                <span>${stream.viewers}</span>
              </div>
            </div>
            <p class="live-stream-description">${stream.description}</p>
            <div class="live-stream-actions">
              <button class="btn" data-action="watch-live">Watch Live</button>
            </div>
          </div>
        </div>
      `;
    });
    
    liveStreamsGrid.innerHTML = streamsHTML;
    
    // Add event listeners to live stream cards
    const streamCards = liveStreamsGrid.querySelectorAll('.live-stream-card');
    streamCards.forEach(card => {
      const watchBtn = card.querySelector('[data-action="watch-live"]');
      
      watchBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const streamId = card.dataset.streamId;
        const stream = this.state.liveStreams.find(s => s.videoId === streamId);
        if (stream) {
          this.watchLiveStream(stream);
        }
      });
    });
  }

  getSportIcon(sport) {
    const icons = {
      football: '‚öΩ',
      basketball: 'üèÄ',
      cricket: 'üèè',
      tennis: 'üéæ',
      baseball: '‚öæ',
      hockey: 'üèí',
      rugby: 'üèâ',
      formula1: 'üèéÔ∏è',
      boxing: 'ü•ä',
      mma: 'ü•ã',
      golf: '‚õ≥'
    };
    
    return icons[sport] || 'üèÜ';
  }

  formatSportName(sport) {
    if (!sport) return 'Sports';
    return sport.charAt(0).toUpperCase() + sport.slice(1);
  }

  parseViews(viewsStr) {
    if (!viewsStr) return 0;
    if (typeof viewsStr === 'number') return viewsStr;
    if (viewsStr.includes('M')) {
      return parseFloat(viewsStr) * 1000000;
    } else if (viewsStr.includes('K')) {
      return parseFloat(viewsStr) * 1000;
    }
    return parseInt(viewsStr) || 0;
  }

  async playVideo(video) {
    // Mark as watched
    this.state.watchedVideos.add(video.videoId);
    
    // Show video in modal
    this.showVideoModal(video);
    
    // Track watch history if user is logged in
    if (this.state.user) {
      await this.trackVideoWatched(video);
    }
  }

  watchLiveStream(stream) {
    // Show live stream in modal
    this.showVideoModal(stream, true);
  }

  showVideoModal(video, isLive = false) {
    const videoModal = document.getElementById('videoModal');
    const videoModalTitle = document.getElementById('videoModalTitle');
    const videoContainer = document.getElementById('videoContainer');
    
    if (!videoModal || !videoModalTitle || !videoContainer) return;
    
    videoModalTitle.textContent = video.title;
    
    if (isLive) {
      videoContainer.innerHTML = `
        <div class="video-player-modal">
          <iframe 
            src="https://www.youtube.com/embed/${video.youtubeId}?autoplay=1" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
          </iframe>
        </div>
      `;
    } else {
      videoContainer.innerHTML = `
        <div class="video-player-modal">
          <iframe 
            src="https://www.youtube.com/embed/${video.youtubeId}?autoplay=1" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
          </iframe>
        </div>
      `;
    }
    
    videoModal.setAttribute('aria-hidden', 'false');
    videoModal.style.display = 'flex';
    
    // Add to watched history
    this.addToWatchedHistory(video);
  }

  async addToWatchedHistory(video) {
    if (!this.state.user) return;
    
    try {
      const response = await fetch('/api/user/track-watch', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          videoId: video.videoId,
          title: video.title,
          duration: video.duration
        })
      });
      
      const data = await response.json();
      if (data.success) {
        console.log('Added to watched history');
      }
    } catch (error) {
      console.error('Error adding to watched history:', error);
    }
  }

  async trackVideoWatched(video) {
    try {
      const response = await fetch('/api/user/track-watch', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          videoId: video.videoId,
          title: video.title,
          duration: video.duration
        })
      });
      
      const data = await response.json();
      if (data.success) {
        console.log('Tracked video watch');
      }
    } catch (error) {
      console.error('Error tracking video watch:', error);
    }
  }

  setupSearch() {
    const searchInput = document.getElementById('videoSearchInput');
    const searchButton = document.getElementById('searchButton');
    const filtersToggle = document.getElementById('filtersToggle');
    const advancedFilters = document.getElementById('advancedFilters');
    const searchResultsContainer = document.getElementById('searchResultsContainer');
    const resetFilters = document.getElementById('resetFilters');
    
    // Toggle advanced filters
    if (filtersToggle && advancedFilters) {
      filtersToggle.addEventListener('click', () => {
        advancedFilters.classList.toggle('active');
      });
    }
    
    // Perform search on button click
    if (searchButton) {
      searchButton.addEventListener('click', () => {
        this.performSearch();
      });
    }
    
    // Perform search on Enter key
    if (searchInput) {
      searchInput.addEventListener('keyup', (e) => {
        if (e.key === 'Enter') {
          this.performSearch();
        } else {
          // Show search suggestions as user types
          this.showSearchSuggestions();
        }
      });
      
      // Hide search results when clicking outside
      document.addEventListener('click', (e) => {
        if (searchInput && !searchInput.contains(e.target) && searchResultsContainer && !searchResultsContainer.contains(e.target)) {
          searchResultsContainer.classList.remove('active');
        }
      });
    }
    
    // Reset filters
    if (resetFilters) {
      resetFilters.addEventListener('click', () => {
        this.resetSearchFilters();
      });
    }
    
    // Update filters when they change
    const filterSelects = document.querySelectorAll('.filter-select');
    filterSelects.forEach(select => {
      select.addEventListener('change', () => {
        this.updateSearchFilters();
      });
    });
  }

  updateSearchFilters() {
    this.state.searchFilters = {
      sport: document.getElementById('sportFilter')?.value || 'all',
      category: document.getElementById('categoryFilter')?.value || 'all',
      duration: document.getElementById('durationFilter')?.value || 'all',
      date: document.getElementById('dateFilter')?.value || 'all',
      sort: document.getElementById('sortFilter')?.value || 'relevance'
    };
  }

  resetSearchFilters() {
    const sportFilter = document.getElementById('sportFilter');
    const categoryFilter = document.getElementById('categoryFilter');
    const durationFilter = document.getElementById('durationFilter');
    const dateFilter = document.getElementById('dateFilter');
    const sortFilter = document.getElementById('sortFilter');
    
    if (sportFilter) sportFilter.value = 'all';
    if (categoryFilter) categoryFilter.value = 'all';
    if (durationFilter) durationFilter.value = 'all';
    if (dateFilter) dateFilter.value = 'all';
    if (sortFilter) sortFilter.value = 'relevance';
    
    this.updateSearchFilters();
    this.performSearch();
  }

  performSearch() {
    const searchInput = document.getElementById('videoSearchInput');
    const searchResultsContainer = document.getElementById('searchResultsContainer');
    
    if (searchInput) {
      this.state.searchQuery = searchInput.value.trim();
      
      // Hide search results
      if (searchResultsContainer) {
        searchResultsContainer.classList.remove('active');
      }
      
      // Update the videos and streams based on search
      this.renderVideos();
      this.renderLiveStreams();
      
      // Show search stats
      this.showSearchStats();
    }
  }

  showSearchSuggestions() {
    const searchInput = document.getElementById('videoSearchInput');
    const searchResultsContainer = document.getElementById('searchResultsContainer');
    
    if (!searchInput || !searchResultsContainer) return;
    
    const query = searchInput.value.trim().toLowerCase();
    
    if (query.length < 2) {
      searchResultsContainer.classList.remove('active');
      return;
    }
    
    // Find matching videos and streams
    const videoResults = this.state.videos.filter(video => 
      video.title.toLowerCase().includes(query) ||
      (video.description && video.description.toLowerCase().includes(query)) ||
      (video.sport && video.sport.toLowerCase().includes(query)) ||
      (Array.isArray(video.category) 
        ? video.category.some(cat => cat.toLowerCase().includes(query))
        : (video.category && video.category.toLowerCase().includes(query))) ||
      (video.tags && video.tags.some(tag => tag.toLowerCase().includes(query)))
    );
    
    const streamResults = this.state.liveStreams.filter(stream => 
      stream.title.toLowerCase().includes(query) ||
      (stream.description && stream.description.toLowerCase().includes(query)) ||
      (stream.sport && stream.sport.toLowerCase().includes(query))
    );
    
    const allResults = [...videoResults, ...streamResults];
    
    if (allResults.length === 0) {
      searchResultsContainer.innerHTML = `
        <div class="no-results">
          <p>No results found for "${query}"</p>
        </div>
      `;
    } else {
      let resultsHTML = `
        <div class="search-stats">
          Found ${allResults.length} results for "${query}"
        </div>
      `;
      
      allResults.slice(0, 8).forEach(result => {
        const isStream = result.type === 'live';
        const type = isStream ? 'Live Stream' : 'Video';
        const icon = isStream ? 'üî¥' : 'üìπ';
        
        resultsHTML += `
          <div class="search-result-item" data-id="${result.videoId}" data-type="${isStream ? 'stream' : 'video'}">
            <div class="search-result-thumbnail">
              <img src="${result.thumbnail}" alt="${result.title}">
            </div>
            <div class="search-result-content">
              <div class="search-result-title">${result.title}</div>
              <div class="search-result-meta">
                ${icon} ${type} ‚Ä¢ ${isStream ? (result.viewers || '0') + ' viewers' : (result.views || '0')}
              </div>
            </div>
            <div class="search-result-type">${type}</div>
          </div>
        `;
      });
      
      searchResultsContainer.innerHTML = resultsHTML;
      
      // Add click handlers to search results
      const resultItems = searchResultsContainer.querySelectorAll('.search-result-item');
      resultItems.forEach(item => {
        item.addEventListener('click', () => {
          const id = item.dataset.id;
          const type = item.dataset.type;
          
          if (type === 'video') {
            const video = this.state.videos.find(v => v.videoId === id);
            if (video) {
              this.playVideo(video);
            }
          } else {
            const stream = this.state.liveStreams.find(s => s.videoId === id);
            if (stream) {
              this.watchLiveStream(stream);
            }
          }
          
          searchResultsContainer.classList.remove('active');
          if (searchInput) searchInput.value = '';
        });
      });
    }
    
    searchResultsContainer.classList.add('active');
  }

  showSearchStats() {
    const videoCount = document.querySelectorAll('#videosGrid .video-card').length;
    const streamCount = document.querySelectorAll('#liveStreamsGrid .live-stream-card').length;
    
    if (this.state.searchQuery) {
      const searchStats = document.createElement('div');
      searchStats.className = 'search-stats';
      searchStats.innerHTML = `Showing ${videoCount} videos and ${streamCount} live streams for "${this.state.searchQuery}"`;
      
      // Insert at the top of the videos section
      const videosSection = document.querySelector('.videos-section');
      if (videosSection) {
        const existingStats = videosSection.querySelector('.search-stats');
        if (existingStats) {
          existingStats.remove();
        }
        videosSection.insertBefore(searchStats, videosSection.firstChild);
      }
    } else {
      // Remove search stats if no query
      const existingStats = document.querySelector('.search-stats');
      if (existingStats) {
        existingStats.remove();
      }
    }
  }

  setupEventListeners() {
    // Logout functionality
    const logoutBtn = document.getElementById('logoutBtn');
    const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
    
    if (logoutBtn) {
      logoutBtn.addEventListener('click', (e) => {
        e.preventDefault();
        this.handleLogout();
      });
    }
    
    if (mobileLogoutBtn) {
      mobileLogoutBtn.addEventListener('click', (e) => {
        e.preventDefault();
        this.handleLogout();
      });
    }

    // Login button functionality
    const loginBtn = document.getElementById('loginBtn');
    const mobileLoginBtn = document.getElementById('mobileLoginBtn');
    const userDropdown = document.getElementById('userDropdown');
    const mobileUserDropdown = document.getElementById('mobileUserDropdown');

    if (loginBtn && userDropdown) {
      loginBtn.addEventListener('click', (e) => {
        if (this.state.user) {
          // User is logged in, toggle dropdown
          userDropdown.style.display = userDropdown.style.display === 'block' ? 'none' : 'block';
        } else {
          // User is not logged in, redirect to login page
          window.location.href = 'login.html';
        }
      });
    }

    if (mobileLoginBtn && mobileUserDropdown) {
      mobileLoginBtn.addEventListener('click', (e) => {
        if (this.state.user) {
          // User is logged in, toggle dropdown
          mobileUserDropdown.style.display = mobileUserDropdown.style.display === 'block' ? 'none' : 'block';
        } else {
          // User is not logged in, redirect to login page
          window.location.href = 'login.html';
        }
      });
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      if (userDropdown && loginBtn && !loginBtn.contains(e.target) && !userDropdown.contains(e.target)) {
        userDropdown.style.display = 'none';
      }
      if (mobileUserDropdown && mobileLoginBtn && !mobileLoginBtn.contains(e.target) && !mobileUserDropdown.contains(e.target)) {
        mobileUserDropdown.style.display = 'none';
      }
    });

    // Featured video play button
    const featuredVideoPlayer = document.getElementById('featuredVideoPlayer');
    if (featuredVideoPlayer) {
      featuredVideoPlayer.addEventListener('click', () => {
        const videoId = featuredVideoPlayer.dataset.videoId;
        // Find the featured video in our data
        const video = this.state.videos.find(v => v.videoId === videoId) || 
                     this.state.liveStreams.find(v => v.videoId === videoId);
        if (video) {
          this.playVideo(video);
        }
      });
    }
    
    // Video category filters - FIXED: Now properly updates both videos and live streams
    const videoCategories = document.querySelectorAll('.video-category');
    videoCategories.forEach(category => {
      category.addEventListener('click', () => {
        // Update active state
        videoCategories.forEach(c => c.classList.remove('active'));
        category.classList.add('active');
        
        // Update current category
        this.state.currentCategory = category.dataset.category;
        
        // Re-render both videos and live streams with the new filter
        this.renderVideos();
        this.renderLiveStreams();
      });
    });
    
    // Video sort buttons
    const sortButtons = document.querySelectorAll('.section-actions .btn');
    sortButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Update active state
        sortButtons.forEach(b => {
          b.classList.remove('active');
          b.classList.add('ghost');
        });
        button.classList.remove('ghost');
        button.classList.add('active');
        
        // Update current sort
        this.state.currentSort = button.dataset.sort;
        this.renderVideos();
      });
    });
    
    // Video modal close
    const videoModal = document.getElementById('videoModal');
    const videoModalClose = document.getElementById('videoModalClose');
    const videoModalBackdrop = document.getElementById('videoModalBackdrop');
    
    if (videoModalClose) {
      videoModalClose.addEventListener('click', () => {
        this.closeVideoModal();
      });
    }
    
    if (videoModalBackdrop) {
      videoModalBackdrop.addEventListener('click', () => {
        this.closeVideoModal();
      });
    }
    
    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && videoModal && videoModal.style.display === 'flex') {
        this.closeVideoModal();
      }
    });
    
    // Header search functionality
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
      searchInput.addEventListener('input', this.debounce(() => {
        this.handleHeaderSearch(searchInput.value);
      }, 300));
    }
  }

  handleHeaderSearch(query) {
    // This handles the search in the header (small search box)
    if (query.trim() === '') {
      this.state.searchQuery = '';
      this.renderVideos();
      this.renderLiveStreams();
      return;
    }
    
    this.state.searchQuery = query;
    this.renderVideos();
    this.renderLiveStreams();
  }

  closeVideoModal() {
    const videoModal = document.getElementById('videoModal');
    const videoContainer = document.getElementById('videoContainer');
    
    if (videoModal && videoContainer) {
      videoModal.setAttribute('aria-hidden', 'true');
      videoModal.style.display = 'none';
      videoContainer.innerHTML = '';
    }
  }

  // Fallback methods in case API fails
  showFallbackData() {
    // Sample video data for fallback
    this.state.videos = [
      {
        videoId: 'v1',
        title: 'Manchester United vs Chelsea - Premier League Highlights',
        thumbnail: 'https://i.pinimg.com/1200x/1a/e8/dd/1ae8ddb20fe93a6dec8e20ece6da259e.jpg',
        youtubeId: 'z0I8LF4oCKw',
        duration: '12:34',
        views: '1.2M',
        publishedAt: '2 hours ago',
        category: 'football',
        tags: ['highlights'],
        sport: 'football',
        description: 'Watch the thrilling encounter between Manchester United and Chelsea',
        type: 'video'
      },
      {
        videoId: 'ls3',
        title: 'ICC World Cup: India vs Pakistan - LIVE',
        thumbnail: 'https://i.pinimg.com/1200x/72/75/cb/7275cbc36e4dece4e59a3f47d4cc4906.jpg',
        youtubeId: 'fTyeo4zqb-o',
        viewers: '1.2M',
        publishedAt: 'Live now',
        category: 'cricket',
        tags: ['live'],
        sport: 'cricket',
        description: 'The biggest rivalry in cricket - live from MCG',
        type: 'live',
        status: 'live',
        views: '0'
      }
    ];
    this.renderLiveStreams();
  }

  debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  showToast(message) {
    const toast = document.getElementById('toast');
    if (!toast) return;
    
    toast.textContent = message;
    toast.classList.add('show');
    
    setTimeout(() => {
      toast.classList.remove('show');
    }, 3000);
  }
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  console.log("Watch page loaded");
  window.watchApp = new WatchApp();
});
</script>
</body>
</html>